from textwrap import dedent


def build_obfuscate_prompt(stem: str) -> str:
    return dedent(
        f"""
        你是题干改写智能体。请在不改变题目核心语义与可解性的前提下，隐去题干中对图片的具体细节描述与解题引导。

        目标:
        - 保留“图中/图示/图像/图片”等轻量视觉锚点（至少出现一次）。
        - **精准保留计算锚点**：对于计算类题目，**必须保留**图片中关键的视觉读数、刻度、比例或特定状态的描述（例如“图中仪表盘显示约为 2.4”或“红色区域占比约 1/4”）。**严禁泛化**这些解题必须的数值输入，否则题目将不可解。
        - **仅泛化装饰性细节**：只删除与解题逻辑无关的背景描述（如图片的具体的拍摄角度、无关的颜色细节）。
        - 删除直接的解题引导与步骤提示（如“根据/因此/所以/先...再/请计算/代入/由此可知”）。
        - **客观化陈述**：彻底删除所有来源指代词与图号编号（如“文中”“原文”“文本内容”“参考信息”“图1/图2/图10/图X/图表1/如图X”），直接陈述规则（例如：“已知判定规则为：当 X > 5 时...”）。
        - 不新增信息、不改变规则或条件的逻辑含义。
        - 若原题干包含规则/条件描述，必须保留为中性表述，避免被删空。
        - 保持单段自然语言，长度与原题干接近。

        原题干:
        {stem.strip()}

        只输出以下格式:
        <stem>改写后的题干</stem>
        """
    ).strip()
