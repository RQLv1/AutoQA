from textwrap import dedent


def build_obfuscate_prompt(stem: str) -> str:
    return dedent(
        f"""
        你是题干改写智能体。请在不改变题目核心语义与可解性的前提下，隐去题干中对图片的具体细节描述与解题引导。

        目标:
        - 保留“图中/图示/图像/图片”等轻量视觉锚点（至少出现一次）。
        - 删除或泛化具体位置、方向、颜色、形状、尺度、数值读数等细节。
        - 删除直接的解题引导与步骤提示（如“根据/因此/所以/先...再/请计算/代入/由此可知”）。
        - 彻底删除所有来源指代词（如“按文中”、“据资料”、“Reference表明”、“文献指出”），将其改写为客观事实陈述（如将“按文中规定A=1”改写为“已知 A=1”）。
        - 不新增信息、不改变规则或条件的逻辑含义。
        - 若原题干包含规则/条件描述，必须保留为中性表述，避免被删空。
        - 保持单段自然语言，长度与原题干接近。

        原题干:
        {stem.strip()}

        只输出以下格式:
        <stem>改写后的题干</stem>
        """
    ).strip()
