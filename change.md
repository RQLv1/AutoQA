
## 总体改法（核心思想）

把“把所有判据/公式明着写进题干、还教你按(1)(2)(3)算”的要求，改成：

* **题干只保留必要信息** （最多 1–2 句规则/阈值 + 必要的基准值/读图对象）
* **禁止“提示性结构”** （禁止【】小标题、禁止(1)(2)(3)、禁止“请按步骤/依次求/代入公式”）
* **链式关系先在草稿阶段合并** （A→NVO→nDEG→M→等级 这种链条，题干里只留“最终判断需要的最短等价表达”或干脆改问“最接近的 M 值”）
* **分级阈值表不进题干** ：要么改问数值（M/A），要么把阈值表转成一行短语（例如“按文中等级阈值划分”），阈值细节放到参考答案/评分端

---

## 需要改的 3 处提示词（你现有 workflow 最可能对应的三个阶段）

### 1) 题目生成阶段（你现在会产出“【已知条件与判据】”的那段）

把类似这种要求删掉/替换：

* ❌“必须将 fact_hint 改写为题干中的【已知条件/判据/公式/参数】(至少X条)”
* ❌“题干必须显式包含至少2条判据/公式”
* ❌“必须写任务说明/步骤引导让模型可解”

改成下面这种 **硬约束** （建议直接粘进 prompt 里）：

```text
风格硬约束：
- 题干正文不得出现“【】”以及“已知条件/判据/任务说明/提示/步骤/解题思路”等词；
- 不得使用(1)(2)(3)、“先…再…”等指令式引导；
- 题干必须为一个连续自然段（A-D选项可换行），不得出现分节标题。
信息约束：
- 题干中最多写 1–2 句规则/阈值/定义；若存在链式定义(A→B→C)，必须先化简成等价的一条表达再写入；
- 分级阈值表默认不写入题干；若必须提及等级，只允许写“按文中等级阈值划分”这一句。
```

---

### 2) 计算草稿阶段（你现在的 operate_calculation / fact 生成）

你现在的问题是：草稿阶段输出了“完整推导链条 + 全套公式 + 阈值表”，最终题干就会被“搬运”。

把草稿阶段的要求改成：

```text
你要输出两部分：
(1) 内部计算链条：可长，可包含公式与中间变量（仅供参考答案/校验，不进题干）
(2) 可入题干的“精简条件句”：只能 1–2 句，必须自然语言，不要公式墙，不要小标题，不要编号，不要逐步指令；
    若有链式关系，先代数化简为一条等价关系再写。
```

关键点： **把“可入题干的短句”作为单独字段** （比如 `short_rule_for_stem`），并明确“final 只能用这个字段”。

---

### 3) final 压缩阶段（你现在把草稿硬塞回题干）

把类似“至少2条公式/判据”改为：

```text
题干仅允许包含必要规则（1–2句，最多2句），其余推导、阈值表、计算路径必须进入参考答案，不得进入题干。
```

并加一句强制选择策略：

```text
若题干包含超过2个等式/超过2个阈值区间/出现“任务说明/判据/步骤”等任一禁词，则必须重写题干并压缩到合规。
```

---

## 额外加一层“自动过滤重写”（强烈推荐，几行规则就能极稳）

在 final 输出前做一个文本检查（不改模型也能把坏题挡住）：

* 命中任一即触发重写：
  * 包含：`【` 或 `已知条件|判据|任务说明|步骤|\(1\)|\(2\)|\(3\)`
  * 等号 `=` 出现次数 > 2
  * “保留两位小数/代入公式/依次求出”等引导词出现
* 重写指令模板就一句话：
  “保持同一考点与答案不变，把题干压缩为一个自然段，仅保留必要的读图对象、两个基准值、以及一条简短规则（最多2句），删除所有步骤与判据表。”

---

## 题干改写目标长相（你要的“少提示”风格）

你现在那题，最终题干应长这样（示意）：

> 图 1d 与 1e 的黄色标注分别给出 (200) 与 (101) 晶面间距读数，基准间距为 1.90 Å 与 3.51 Å。用应变定义计算两处拉伸应变后，若两处应变差超过 0.34% 则取“最大应变×1.2”作为活化强度，否则取均值；并据此按文中映射关系得到 650 nm 的调制幅度并划分等级。该样品最可能属于哪一等级？
> A…B…C…D…

（没有【已知条件】、没有【任务说明】、没有一堆公式与阈值表。）

---

## 新增

同时建议直接把选择题从“问等级”改成“问 M 最接近多少”，这样连等级阈值表都完全不需要出现在题干里，题会更自然也更像真实考试题。
